\documentclass[aspectratio=169, 14pt]{beamer}
\usepackage{tikz}
\usepackage{subfig}
\title{Using Pseudo-Random Numbers Repeatably in a Fine-Grain Multithreaded Simulation}
\author{Dmitry Savin\\
supervised by John Apostolakis and Sandro Wenzel}
\date{\today}

\usepackage[utf8]{inputenc}

\setbeamersize{text margin left=0pt,text margin right=0pt}

\begin{document}
\begin{large}

 \frame{\titlepage}


 \begin{frame}{Motivation}
 \large
  \begin{itemize}
   \item Geant4 is a toolkit for the Monte Carlo simulation of the passage of particles through matter
   \item Monte Carlo simulation relies on pseudo-random numbers
   \item The numbers must seem uncorrelated
   \item Reproducibility from any point of simulation is needed
  \end{itemize}
 \end{frame}
 
  \begin{frame}{Motivation}
  \large
  \begin{itemize}
   \item Geant4 uses event-level parallelism
   \begin{itemize}
     \item Each event is simulated independently
     \item Independent PRNGs in a small fixed number of threads
    \end{itemize}
    $\Rightarrow$ an event is defined by the generator state at the beginning\\ \ \\
   \item GeantV uses track-level parallelism
    \begin{itemize}
     \item Similar tracks from many events are collected in "baskets"
     \item Baskets are processed in parallel to utilize vectorisation
     \item A big number of tracks is needed to reduce overhead
     \item Number of tracks, baskets and threads change during the simulation
    \end{itemize}
   $\Rightarrow$ a new mechanism is needed for reproducibility
  \end{itemize}

 \end{frame}

 
 \begin{frame}{Pedigrees}
  \begin{itemize}
   \item the rank of a track - the number of sibling tracks created by its parent track before it
   \item the pedigree of a track - the sequence of ranks of its ancestor tracks
   \item the hashed pedigree can be stored by the track and used to seed the generator
  \end{itemize}
 \end{frame}


 \begin{frame}{Merkle–Damgård hash calculation}
  \begin{figure}
   \scalebox{.5}{\input{damgard}}
  \end{figure}
 \end{frame}
 
 
 \begin{frame}{Performance}
  \begin{figure}
   \begin{subfloat}[][]
    \centering
    \scalebox{.33}{\input{mean}}  
% %    \caption{Caption A}
%     \label{fig:A}
   \end{subfloat}
   \begin{subfloat}[][]
    \centering
    \scalebox{.33}{\input{smallMean}}  
%    \caption{Caption B}
    \label{fig:B}
   \end{subfloat}
  \end{figure}
 \end{frame}

 \begin{frame}{Counter-Based Pseudo-Random Number Generators}
  \begin{itemize}
   \item CPRNG state transition function is a simple increment
   \item The randomness is produces by the output function
   \item Seeding is a single assignment
   \item A cryptographic function can be used as the output function
   \item Faster functions can be used under relaxed requirements
   \item Random123 library provides a set of such functions
   \item Philox1x64, Threefry1x64 were wrapped in a CLHEP interface
   \item Vectorization may increase performance
  \end{itemize}

 \end{frame}
 
 
 \begin{frame}{Conclusion}
  \begin{itemize}
   \item Implemented a Geant4 prototype which can perform fully reproducible simulations in a multithreaded environment and under the exchange of the order of track propagation.
   \item Profiled the overhead to achieve this reproducibility for different random number engines and showed that it is quite low for selected engines.
  
   \item \bf It is worth to apply a similar algorithm for reproducible pseudo-random number generation in GeantV.
  \end{itemize}

 \end{frame}
 
 \begin{frame}{Acknowledgements}

  \centering
  I would like to thank my mentors\\
  John Apostolakis and Sandro Wenzel\\
  for productive collaboration. 

 \end{frame}
 
 
 \end{large}
\end{document}
